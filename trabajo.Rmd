# Trabajo FID

El dataset utilizado ha sido https://www.kaggle.com/sudalairajkumar/novel-corona-virus-2019-dataset?select=covid_19_data.csv

# Predicción supervisada

## CLASIFICACIÓN MEDIANTE ÁRBOL

Instalamos la librería rattle
```{r}
install.packages("rattle")
library(rpart)
library(rpart.plot)
```

Vamos a realizar un arbol de decisión para obtener los campos más importantes.
```{r}
data_arbol <- read.delim('datos/arbol_train.csv', sep=",", head = TRUE)
colnames(data)
```

Dibujamos el arbol y lo exportamos al fichero arbol.pdf, podemos observar como el campo más importante es la fecha del contagio.
```{r}
tree <- rpart(Confirmed ~ ., data_arbol, method="class", minsplit = 2)
rpart.plot(tree)
```



Cargamos los datos de test
```{r}
test <- read.delim('datos/arbol_test.csv', sep=",", head = TRUE)
colnames(data)
```

Ahora vamos a predecir los valores del conjunto de test y obtener la matriz de confusión y acurracy
```{r}
pred <- predict(tree, test, type="class")
conf <- table(test$Confirmed, pred)
View(conf)

acc <- sum(diag(conf)) / sum(conf)
print(acc)
```

## REGRESIÓN LINEAL
```{r}
data <- read.delim('datos/regresion_train.csv', sep=",", head = TRUE)
```

```{r}
regresion <- lm(Confirmed~ObservationDate, data = data)
summary(regresion)
```

Podemos observar como el número de contagios aumenta por día
```{r}
plot(data$ObservationDate, data$Confirmed, xlab='ObservationDate', ylab='Confirmed')
abline(regresion)
```

Predecimos un día correspondiente al archivo datos/regresion_test.csv, por ejemplo el día 09/28/2020 en el cual hubo 33399009 contagios
```{r}

# Primero calculamos la diferencia de días
days <- as.Date(c("2020-09-28", "2020-01-22"))
days_diff <- mydates[1] - mydates[2]
days_diff <- as.numeric(days_diff)
#Hay 250 días de diferencia


confirmed <- data.frame(ObservationDate = days_diff)
predict(regresion, confirmed)
```
Ha predicho 35206747, y en el día 250 se datan de 35206747, por lo que ha predicho 1807738 contagios de menos.


## Naive Bayes

Naive Bayes es un modelo para predecir por probabilidad Bayesiana.

Primero instalarmos el paquete naivebayes, además es necesario usar Rtools (https://cran.r-project.org/bin/windows/Rtools/)
```{r}
install.packages("naivebayes")
```

```{r}
library(naivebayes)
```


```{r}
data_sintomas <- read.delim('datos_sintomas/Cleaned-Data.csv', sep=",", head = TRUE)
```


Ahora vamos a calcular la probabilidad de que el Covid afecte de forma grave en función de la edad y de si padece de fiebre

```{r}
nb1 <- naive_bayes(as.factor(Severity_Severe) ~ Age_60.+ Fever, data_sintomas)

plot(nb1)

```


```{r}
nb2 <- naive_bayes(as.factor(Severity_Severe) ~ Age_0.9 +  Fever, data_sintomas)


plot(nb2)
```

Ahora calcuaremos la probabilidad de que sea un caso grave en supuesto que la persona tenga mas de 60 años y fiebre
```{r}
data_test = data_sintomas[1,]
data_test$Age_60. = 1
data_test$fever = 1
predict = predict(nb1, data_test, type="prob")    
predict

```



```{r}
data_test = data_sintomas[1,]
data_test$Age_0.9 = 1
data_test$fever = 1
predict = predict(nb2, data_test, type="prob")    
predict
```
La probabilidades la misma, por lo que podemos concluir con que tanto la edad como el tener o no fiebre no implacta en si es grave o no

# Predicción no supervisada

